<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plot Data from Local File with Plotly</title>
    <!-- Plotly.js library -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Upload and Plot Data</h1>

    <!-- File input for the user to select a file -->
    <input type="file" id="fileInput" accept=".csv,.txt" />

    <!-- Dropdowns to select columns for X and Y axes -->
    <div id="columnSelectors" style="display:none;">
        <label for="xColumn">Select X Column:</label>
        <select id="xColumn"></select>

        <label for="yColumn">Select Y Column:</label>
        <select id="yColumn"></select>

        <button id="plotButton">Plot Data</button>
    </div>

    <!-- Div where the plot will be rendered -->
    <div id="plot"></div>

    <script>
        let parsedData = []; // To store parsed CSV data
        let columnNames = []; // To store detected column names

        // Listen for file input change event
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0]; // Get the selected file
            if (file) {
                const reader = new FileReader(); // Create a FileReader to read the file

                // Define what happens when the file is successfully read
                reader.onload = function(e) {
                    const text = e.target.result; // Get the file content as text
                    const separator = detectSeparator(text); // Detect the separator
                    parsedData = parseCSV(text, separator); // Parse the CSV data with the detected separator

                    columnNames = parsedData[0]; // Assume first row contains column headers
                    populateDropdowns(columnNames); // Populate the dropdown menus with column names

                    document.getElementById('columnSelectors').style.display = 'block'; // Show dropdowns
                };

                // Read the file as text
                reader.readAsText(file);
            }
        });

        // Function to detect the separator in the text
        function detectSeparator(text) {
            const potentialSeparators = [',', ';', '\t', '|', ' ']; // Common separators
            const firstLine = text.split('\n')[0]; // Get the first line of the file
            let bestSeparator = ',';
            let maxCount = 0;

            // Check which separator appears most often in the first line
            potentialSeparators.forEach(separator => {
                const count = firstLine.split(separator).length;
                if (count > maxCount) {
                    maxCount = count;
                    bestSeparator = separator;
                }
            });

            return bestSeparator;
        }

        // Function to parse CSV data using the detected separator
        function parseCSV(text, separator) {
            const rows = text.split('\n'); // Split the text into rows
            return rows.map(row => row.split(separator)); // Split each row into columns using the detected separator
        }

        // Function to populate dropdown menus with column names
        function populateDropdowns(columns) {
            const xDropdown = document.getElementById('xColumn');
            const yDropdown = document.getElementById('yColumn');

            // Clear existing options
            xDropdown.innerHTML = '';
            yDropdown.innerHTML = '';

            // Populate the dropdowns with column names
            columns.forEach((col, index) => {
                const optionX = document.createElement('option');
                optionX.value = index;
                optionX.text = col;
                xDropdown.appendChild(optionX);

                const optionY = document.createElement('option');
                optionY.value = index;
                optionY.text = col;
                yDropdown.appendChild(optionY);
            });
        }

        // Event listener for the "Plot Data" button
        document.getElementById('plotButton').addEventListener('click', function() {
            const xIndex = document.getElementById('xColumn').value; // Get selected X column index
            const yIndex = document.getElementById('yColumn').value; // Get selected Y column index

            // Extract selected columns' data
            const xValues = parsedData.slice(1).map(row => row[xIndex]); // Skip the header row
            const yValues = parsedData.slice(1).map(row => parseFloat(row[yIndex])); // Convert Y values to numbers

            // Call the function to plot the data with Plotly
            plotData(columnNames[xIndex], xValues, columnNames[yIndex], yValues);
        });

        // Function to plot the data using Plotly
        function plotData(xLabel, xValues, yLabel, yValues) {
            const trace = {
                x: xValues, // X-axis values
                y: yValues, // Y-axis values
                type: 'scatter', // You can change this to 'bar', 'line', etc.
                mode: 'markers'
            };

            const data = [trace];

            const layout = {
                title: 'Custom Data Plot',
                xaxis: { title: xLabel },
                yaxis: { title: yLabel }
            };

            // Plot the data inside the 'plot' div
            Plotly.newPlot('plot', data, layout);
        }
    </script>
</body>
</html>
